# DNS

## 🎈DNS(Domain Name System)란?
- 웹사이트에 접속할 때 우리는 외우기 어려운 IP 주소 대신 도메인 이름을 사용한다.
- 도메인 이름을 사용했을 때 입력한 도메인을 실제 네트워크 상에서 사용하는 IP 주소로 바꾸고 해당 IP 주소로 접속하는 과정이 필요하다.
- 이러한 과정, 전체 시스템을 `DNS(Domain Name System)`이라 한다.
- 이러한 시스템은 전세계적으로 약속된 규칙을 공유한다.
- 상위 기관에서 인증된 기관에게 도메인을 생성하거나 IP 주소로 변경할 수 있는 `권한`을 부여한다.
- DNS는 이처럼 상위 기관과 하위 기관과 같은 **계층 구조** 를 가지는 **분산 데이터베이스 주소** 를 가진다.

## 🎈DNS 구성 요소
1. 도메인 네임 스페이스(Domain Name Space)
2. 네임 서버(Name Server) : 권한이 있는 DNS 서버
3. 리졸버(Resolver) : 권한이 없는 DNS 서버

- DNS에 필요한 구성요소
	- 우선 "이 도메인 이름은 이 IP 주소이다"라는 텍스트를 저장하는 데이터베이스가 필요하다.
	- 그리고 분산된 데이터가 어디 저장되어 있는지 찾을 프로그램들이 필요하고 찾았으면 해당 IP 주소로 이동할 프로그램(브라우저 등)이 필요하다.
- `Domain Name Space` 라는 규칙(방법)으로 도메인 이름 저장을 분산한다.
- `Name Server`가 해당 도메인 이름의 IP 주소를 찾는다. (DNS 서버와 같은 말, 그런데 리졸버 서버 등 시스템 안에서 다른 역할을 하는 서버도 있기에 그냥 DNS 서버라고 하는 것보다 네임 서버라고 는데 의미 전달 시 더 정확함)
- `Resolver` 가 DNS 클라이언트 요청을 네임 서버로 전달하고 찾은 정보를 클라이언트에게 제공하는 기능을 수행한다.
	- 어떤 네임 서버에서 찾아야 하는지, 이미 캐시되어 있는지 등 어떻게든 찾아서 클라이언트에게 결과를 전달하는 역할
	- 리졸버는 단말에 구현하는 것은 무리라 보통은 리졸버가 구현된 네임 서버의 IP 주소만을 파악한다.
	- 대표적인 것이 KT/LG/SK와 같은 ISP(통신사) DNS가 있고, 브라우저 우회 용도로 많이 쓰는 구글 DNS, 클라우드 플레어와 같은 Public DNS 서버가 있다.
	- Resolver = Recursive DNS Server = Local Server (of  ISP) = Recursor

### DNS가 계층 구조를 가지는 분산 데이터베이스 구조를 택한 이유
- 도메인은 IP 주소로 변경해주는 서버(네임 서버)가 한대만 있지 않기 때문이다.(네임 서버 한대만 있다면 컴퓨터의 성능도 무척 좋아야 하고, 물리적 거리를 극복할 정도가 되어야 함..!)
- 그렇다고 여러 서버(네임서버)를 만들게 되면 해당 정보(도메인과 IP 주소간의 매핑 정보)를 모든 서버에서 공유해야 한다. 
- 그래서 **도메인을 계층적으로 구분하는 정보(도메인과 IP 주소)를 분산하는 구조** 를 선택하게 되었다.
- 따라서 도메인에 닷(dot), 점으로 계층을 나타낸다.

## 🎈DNS 동작 방식
> DNS 동작은 아래와 같은 아이디어로 구현됨

1. `웹 브라우저`는 `해결사 서버`에게 요청한다
	* "www.chaechae.kr의 IP 주소 알려주세요"
2. 해결사 서버는 `최상위 기관에서 관리하는 네임 서버`에게 요청한다.
	* ".kr이라는 도메인 있나요?"
3. 최상위 기관에서 관리하는 네임서버는 응답한다.
	* ".kr은 한국 국가 도메인입니다. .kr 네임 서버로 가보세요!"
4. 해결사 서버는 `.kr 네임 서버`에게 요청한다.
	* "chaechae.kr 있나요?"
5. .kr 네임 서버는 응답한다.
	* "네 가비아로 가세요~"
6. 해결사 서버는 `가비아 네임 서버`에게 요청한다.
	* "www.chaechae.kr 있나요?"
7. 가비아 네임 서버는 응답한다.
	* "네 12.345.678.900으로 가세요!"
8. 해결사 서버는 웹 브라우저에게 알려준다.
	* "네 12.345.678.900으로 가세요!"


## 🎈도메인 네임 스페이스(Domain Name Space)
> 도메인 네임 스페이스는 DNS가 저장 관리하는 계층적 구조를 의미한다.
> 도메인 네임 스페이스는 최상위 루트 DNS 서버가 존재하고 그 하위로 연결된 모든 노드가 연속해서 이어진 계층 구조로 되어있다.

![](https://github.com/chae401/chae_study/assets/83829352/b3041f8a-0c3f-428d-ab53-a8d421f59a6f)

### 계층적 도메인 레벨(Hierarchical Domain Level)
- 도메인 네임 스페이스의 트리 구조는 최상위 레벨부터 순차적으로 계층적 소속 관계를 나타낸다.
- 하위 조직의 네임 스페이스를 할당하고 관리하는 방식은 각 하위 기관의 관리 책임자에게 위임된다.
- 예를 들어 chaechae.kr 도메인은 kr 도메인을 관리하는 네임 서버에 등록되어 있고 www.chaechar.kr은 chaechae.kr을 관리하는 네임 서버에 등록되어 있다.

### FQDN(Fully Qualified Domain Name) 전체 도메인 네임
> 도메인의 전체 이름을 표기하는 방식

- 도메인 이름 : chaechae.kr
- 호스트 이름 : www
- FQDN : www.chaechae.kr


## 🎈네임 서버(Name Server = DNS Server)
> 데이터베이스 역할(저장, 관리), 찾아주는 역할, 요청 처이 응답 구현
> 전 세계에 13개의 root DNS 서버가 구축되어 있다.

1. Root DNS 서버
	* ICANN이 직접 관리하는 존엄 서버
	* TLD DNS 서버 IP 주소를 저장하고 안내하는 역할

2. Top-Level Domain(TLD) DNS 서버
	* 도메인 등록 기관리 관리하는 서버
	* Authoritative DNS 서버의 주소를 저장하고 안내하는 역할
	* 도메인 판매 업체(가비아 등)의 DNS 설정이 변경되면 도메인 등록 기관으로 전달되기 때문에 어떤 도메인이 어떤 판매업체(가비아 등)에서 구매했는지 알 수 있다.

3. Second-Level Domain(SLD) DNS 서버(Authoritative DNS 서버라고도 함)
	* 실제 개인 도메인과 IP 주소의 관계가 기록(저장, 변경)되는 서버이다.
	* 일반적으로 도메인/호스팅 업체의 네임 서버를 말한다.

4. 권한 없는 DNS 서버(리졸버 서버, 리컬시브 서버, 리커서)
	* DNS 서버는 도메인 네임 스페이스를 위한 권한 있는 DNS 서버와 권한이 없는 DNS 서버로 구분된다.
	* 위 1,2,3은 권한 있는 DNS 서버이다.
	* 네임 스페이스를 위한 권한 있는 DNS 서버는 IP 주소와 도메인 이름을 매핑한다.
	* 네임 스페이스를 위한 권한 없는 DNS 서버는 질의를 통해 IP 주소를 알아내거나 캐시한다.

## 🎈리졸버(Resolver)
> 리졸버는 웹 브라우저와 같은 DNS 클라이언트의 요청을 네임 서버로 전달하고 네임 서버로부터 정보(도메인 이름과 IP 주소)를 받아 클라이언트에게 제공하는 기능을 수행한다.

## 🎈DNS 동작 과정 전체 설명
### DNS Query
- DNS 클라이언트와 DNS 서버는 DNS 쿼리를 교환한다.
1. **Recursive Query(재귀적 질의)**
	* 결과물(IP 주소)를 돌려주는 작업
	* Recursive 쿼리를 받은 Recursive 서버는 Iterative 하게 권한 있는 네임 서버로 Iterative 쿼리를 보내서 결과적으로 IP 주소를 찾게 되고 해당 결과물을 응답한다.
2. **Iterative Query(반복적 질의)**
	* Recursive DNS 서버가 다른 DNS 서버에게 쿼리를 보내어 응답을 요청하는 작업
	* Recursive 서버가 권한 있는 네임 서버들에게 반복적으로 쿼리를 보내서 결과물(IP 주소)를 알아낸다.
	* Recursive 서버에 이미 IP 주소가 캐시되어있다면 이 과정은 건너뛴다.

![](https://github.com/chae401/chae_study/assets/83829352/1880066d-a033-4e17-918a-81f7f6707c2f)

1. (최초) 웹 브라우저에 www.google.com 을 입력한다,
2. **Recursive Query** - 웹 브라우저는 이전에 방문한 적 있는지 확인한다.
	* 브라우저 캐시 확인
	* OS 캐시 확인
	* 라우터 캐시 확인
	* ISP 캐시 확인(Recursive DNS Server)
3. **Iterative Query** - ISP에서 Root DNS Server, TLD DNS Server, SLD DNS Server 순으로 반복적으로 쿼리를 보내 IP 주소를 응답 받는다.
4. ISP는 해당 IP 주소를 캐시한다.
5. 웹 브라우저에게 응답한다.

[참고자료](https://hanamon.kr/dns%EB%9E%80-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%84%A4%EC%9E%84-%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B0%9C%EB%85%90%EB%B6%80%ED%84%B0-%EC%9E%91%EB%8F%99-%EB%B0%A9%EC%8B%9D%EA%B9%8C%EC%A7%80/)
